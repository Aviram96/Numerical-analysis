import numpy as np
"""Functions:
- is_det(matrix): Checks if the matrix is invertible by calculating its determinant.
- find_norma(matrix): Calculates the maximum row sum norm of a matrix.
- Gaussian_inverse(matrix): Computes the inverse of a given square matrix using Gaussian elimination.
- calc_cond(normA, norm_inverseOf_A): Computes the condition number of a matrix.
"""

def is_det(matrix):
    # Check if matrix is nXn and its determinant not equal to 0
    if matrix.shape[0] != matrix.shape[1]:
        raise ValueError("Input matrix must be square")
    return np.linalg.det(matrix) != 0

def calc_cond(normA,norm_inverseOf_A):
    condition_number = normA * norm_inverseOf_A
    return condition_number


def find_norma(matrix):
    temp_norm = 0
    max_norm = 0
    for i in range(len(matrix)):
        for j in range(len(matrix)):
            temp_norm+= abs(matrix[i][j])
        if max_norm < temp_norm:
            max_norm=temp_norm
            temp_norm=0
    return max_norm


def gaussian_inverse(matrix):
    # Check if the matrix is invertible
    is_det(matrix)
    n = matrix.shape[0]
    augmented_matrix = np.hstack((matrix, np.eye(n)))

    # Forward elimination
    for i in range(n):
        if augmented_matrix[i, i] == 0:
            raise ValueError("Matrix is singular, cannot find its inverse.")

        if augmented_matrix[i, i] != 1:
            # Scale the current row to make the diagonal element 1
            scalar = 1.0 / augmented_matrix[i, i]
            augmented_matrix[i] = augmented_matrix[i] * scalar

        # Make all rows below this one 0 in the current column
        for j in range(i + 1, n):
            row_factor = augmented_matrix[j, i]
            augmented_matrix[j] = augmented_matrix[j] - row_factor * augmented_matrix[i]

    # Backward substitution
    for i in range(n - 1, -1, -1):
        for j in range(i - 1, -1, -1):
            row_factor = augmented_matrix[j, i]
            augmented_matrix[j] = augmented_matrix[j] - row_factor * augmented_matrix[i]

    # Extract the inverse matrix from the augmented matrix
    inverse_matrix = augmented_matrix[:, n:]
    return inverse_matrix



if __name__ == '__main__':
    # Example matrix
    A = np.array([[1, -1, -2], [2, -3, -5], [-1, 3, 5]])
    try:
        #try to inverse matrix A find the norma and print both, print norma of A,print cond of A and inverse ofA
        A_inverse = gaussian_inverse(A)
        print(f"\nMatrix A:\n {A}")
        print(f"\ninverse of A:\n {A_inverse}")
        print(f"\n||A||: {find_norma(A)}")
        print(f"\ninverse of ||A||: {find_norma(A_inverse)}")
        print(f"\nCOND = {calc_cond(find_norma(A),find_norma(A_inverse))}")


    except ValueError as e:
        print(str(e))

